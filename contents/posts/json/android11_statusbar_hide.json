{
  "title": "Hello Android 11。systemUiVisibility編",
  "created_at": "2020-06-22T00:00:00.000Z",
  "tags": [
    "Android",
    "Android11",
    "Kotlin"
  ],
  "bodyContent": "よーこそ`targetSdkVersion 30`の世界へ\r\n\r\n# 本題\r\nActivityを全画面にしたり、ステータスバー、ナビゲーションを一時的に消すときに`window?.decorView?.systemUiVisibility`がAndroid 11から非推奨になった  \r\n代わりに`WindowInsetsController`を使って消すらしい。\r\n\r\n# 環境\r\n\r\n|なまえ|あたい|\r\n|---|---|\r\n|端末|Pixel 3 XL|\r\n|Android|11 Beta 1|\r\n\r\n# 非表示の種類\r\n- **スワイプすることで一時的にはステータスバー、ナビゲーションバーが表示され、数秒操作しないとまた自動で全画面に戻る**\r\n    - 動画アプリとか\r\n    - `WindowInsetsController.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE`を使う（後述）\r\n- **スワイプして、ステータスバーを表示させるけどそのまま表示したままになる**\r\n    - どこで使ってるかはわからんな\r\n    - `WindowInsetsController.BEHAVIOR_SHOW_BARS_BY_SWIPE`を使う（後述）\r\n\r\n# つくる\r\n\r\nスワイプすると一時的に表示される方  \r\n一時的に表示しているバーは半透明になっている。\r\n\r\n```kotlin\r\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {\r\n    // Android 11 以上と分岐\r\n    window?.insetsController?.apply {\r\n        // スワイプで一時的に表示可能\r\n        systemBarsBehavior = WindowInsetsController.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE\r\n        // StatusBar + NavigationBar 非表示\r\n        hide(WindowInsets.Type.systemBars())\r\n        // ノッチにも侵略\r\n        window?.attributes?.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\r\n    }\r\n} else {\r\n    // Android 10 以前。\r\n    window?.decorView?.systemUiVisibility = View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY or View.SYSTEM_UI_FLAG_FULLSCREEN or View.SYSTEM_UI_FLAG_HIDE_NAVIGATION\r\n}\r\n```\r\n\r\nノッチまでは広げなくていい場合は、ノッチにも侵略の一行をコメントアウトしてね。  \r\n\r\nもし一時的に表示ではなく、一回表示したらずっと出っぱなしにする際は`systemBarsBehavior`を  \r\n\r\n```kotlin\r\nsystemBarsBehavior = WindowInsetsController.BEHAVIOR_SHOW_BARS_BY_SWIPE\r\n```\r\n\r\nにすればいいと思います。\r\n\r\n`Type#systemBars()`を使うと、ステータスバーとナビゲーションバーを消しますが、別に以下のコードでも動きます。  \r\n\r\n```kotlin\r\n// ステータスバー\r\nhide(WindowInsets.Type.statusBars())\r\n// ナビゲーションバー\r\nhide(WindowInsets.Type.navigationBars())\r\n```\r\n\r\n# おまけ\r\nIME（キーボードのこと）もこの`WindowInsetsController`を利用することで、一行で消せるようになりました。\r\n\r\n```kotlin\r\nwindow?.insetsController?.hide(WindowInsets.Type.ime())\r\n```\r\n\r\nキーボード隠すのなんか面倒だし成功したことないからこの方法が使えるのは嬉しい。🥳",
  "bodyHtml": "<p>よーこそ<code>targetSdkVersion 30</code>の世界へ</p>\n<h1>本題</h1>\n<p>Activityを全画面にしたり、ステータスバー、ナビゲーションを一時的に消すときに<code>window?.decorView?.systemUiVisibility</code>がAndroid 11から非推奨になった<br>\n代わりに<code>WindowInsetsController</code>を使って消すらしい。</p>\n<h1>環境</h1>\n<table>\n<thead>\n<tr>\n<th>なまえ</th>\n<th>あたい</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>端末</td>\n<td>Pixel 3 XL</td>\n</tr>\n<tr>\n<td>Android</td>\n<td>11 Beta 1</td>\n</tr>\n</tbody>\n</table>\n<h1>非表示の種類</h1>\n<ul>\n<li><strong>スワイプすることで一時的にはステータスバー、ナビゲーションバーが表示され、数秒操作しないとまた自動で全画面に戻る</strong>\n<ul>\n<li>動画アプリとか</li>\n<li><code>WindowInsetsController.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE</code>を使う（後述）</li>\n</ul>\n</li>\n<li><strong>スワイプして、ステータスバーを表示させるけどそのまま表示したままになる</strong>\n<ul>\n<li>どこで使ってるかはわからんな</li>\n<li><code>WindowInsetsController.BEHAVIOR_SHOW_BARS_BY_SWIPE</code>を使う（後述）</li>\n</ul>\n</li>\n</ul>\n<h1>つくる</h1>\n<p>スワイプすると一時的に表示される方<br>\n一時的に表示しているバーは半透明になっている。</p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {\n    <span class=\"hljs-comment\">// Android 11 以上と分岐</span>\n    window?.insetsController?.apply {\n        <span class=\"hljs-comment\">// スワイプで一時的に表示可能</span>\n        systemBarsBehavior = WindowInsetsController.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE\n        <span class=\"hljs-comment\">// StatusBar + NavigationBar 非表示</span>\n        hide(WindowInsets.Type.systemBars())\n        <span class=\"hljs-comment\">// ノッチにも侵略</span>\n        window?.attributes?.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\n    }\n} <span class=\"hljs-keyword\">else</span> {\n    <span class=\"hljs-comment\">// Android 10 以前。</span>\n    window?.decorView?.systemUiVisibility = View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY or View.SYSTEM_UI_FLAG_FULLSCREEN or View.SYSTEM_UI_FLAG_HIDE_NAVIGATION\n}</code></pre><p>ノッチまでは広げなくていい場合は、ノッチにも侵略の一行をコメントアウトしてね。</p>\n<p>もし一時的に表示ではなく、一回表示したらずっと出っぱなしにする際は<code>systemBarsBehavior</code>を</p>\n<pre><code class=\"hljs\">systemBarsBehavior = WindowInsetsController.BEHAVIOR_SHOW_BARS_BY_SWIPE</code></pre><p>にすればいいと思います。</p>\n<p><code>Type#systemBars()</code>を使うと、ステータスバーとナビゲーションバーを消しますが、別に以下のコードでも動きます。</p>\n<pre><code class=\"hljs\"><span class=\"hljs-comment\">// ステータスバー</span>\nhide(WindowInsets.Type.statusBars())\n<span class=\"hljs-comment\">// ナビゲーションバー</span>\nhide(WindowInsets.Type.navigationBars())</code></pre><h1>おまけ</h1>\n<p>IME（キーボードのこと）もこの<code>WindowInsetsController</code>を利用することで、一行で消せるようになりました。</p>\n<pre><code class=\"hljs\">window?.insetsController?.hide(WindowInsets.Type.ime())</code></pre><p>キーボード隠すのなんか面倒だし成功したことないからこの方法が使えるのは嬉しい。🥳</p>\n",
  "dir": "contents/posts/json",
  "base": "android11_statusbar_hide.json",
  "ext": ".json",
  "sourceBase": "android11_statusbar_hide.md",
  "sourceExt": ".md"
}
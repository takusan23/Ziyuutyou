{
  "title": "Android 11 ã®ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«APIã‚’è©¦ã™",
  "created_at": "2020-06-11T00:00:00.000Z",
  "tags": [
    "Android",
    "Android11",
    "Kotlin",
    "Android R"
  ],
  "bodyContent": "Android 11 Beta ããŸããŠãŠãŠãŠãŠãŠãŠãŠãŠ   \r\nğŸ¥³â†ã“ã‚Œã™ã\r\n\r\n# è¿½è¨˜ï¼š2020/06/13\r\nGoogle PayãŒä½¿ãˆãªã„ã¨è¨€ã„ã¾ã—ãŸã€‚ãŒã€Suicaã§é›»è»Šã«ä¹—ã‚ŒãŸã®ã§å¤šåˆ†**ãŠï½»ï½²ï¾Œï½¹ï½°ï¾€ï½²**ã‚¢ãƒ—ãƒªã§ã¯å¯¾å¿œã—ã¦ã„ãªã„**NFC Pay**ã‚ãŸã‚ŠãŒä½¿ãˆãªã„ã‚“ã ã¨æ€ã„ã¾ã™ã€‚  \r\nFelicaä½¿ã†ç³»ã¯å¤šåˆ†è¡Œã‘ã‚‹ã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ã­ï¼Ÿ\r\n\r\nã‚ã¨ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼(RangeTemplate)å‹•ã„ãŸã®ã§ãã‚Œã‚‚\r\n\r\n# æœ¬é¡Œ\r\nAndroid 11 Beta 1 æ¥ã¾ã—ãŸã€‚  \r\nã‚ãŸã—çš„ã«æ¥½ã—ã¿ã«ã—ã¦ã‚‹æ©Ÿèƒ½ã¯\r\n- Device Control API (æ­£å¼åç§°ã—ã‚‰ã‚“)\r\n    - è¨¼æ˜ã®ON/OFFã¨ã‹æ˜ã‚‹ã•ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãªã©\r\n    - Quick Settings ã®ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ç‰ˆ\r\n    - **ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ãªã‚“ã¦é‡‘ã‹ã‹ã‚‹ã‹ã‚‰ã‚„ã‚‰ãªã„ã¨æ€ã†ï¼ˆã‚ˆã£ã¦ä½¿ã‚ãªã„ï¼‰**\r\n- Dynamic Intent Filter\r\n- Wi-FiçµŒç”±ã®ADB\r\n    - ã‚«ã‚¹ROMã«ã¯å‰ã‹ã‚‰ã‚ã‚‹ã£ã¦ï¼Ÿ\r\n    - å…¬å¼ã§å¯¾å¿œãªã‚“ã§ã™ã‚ˆï¼ï¼ï¼\r\n- Bubble\r\n    - **ä»–ã®ã‚¢ãƒ—ãƒªã«é‡ã­ã¦è¡¨ç¤º**ãŒå¹´ã€…å³ã—ããªã£ã¦ã‚‹ã®ã§ï¼ˆæœ€è¿‘ã€è¨­å®šã‚¢ãƒ—ãƒªã®ä¸Šã«è¡¨ç¤ºã§ããªããªã£ãŸï¼‰ä»£æ›¿ã€‚\r\n    - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†ç”Ÿã®ä»£æ›¿ã«ã¯ãªã‚‰ãªãã†ã€‚ã‚ãã¾ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªå‘ã‘ãªã®ã‹ãªã€‚\r\n\r\n## Android 11 Betaå…¥ã‚Œã‚ˆã†ã¨ã—ã¦ã„ã‚‹å„ä½\r\nGoogle Pay ä½¿ãˆãªããªã‚‹ã‚‰ã—ã„ã‚ˆã€‚DP4ã®æ®µéšã§ã¯ä½¿ãˆãŸã‚“ã ã‘ã©ã¾ãŸä½¿ãˆãªããªã£ãŸã€‚  \r\n![Imgur](https://imgur.com/r914HON.png)  \r\nSuicaä½¿ãˆã‚‹ã‚“ã‹ãªï¼Ÿ  \r\n\r\n# Device Control API ã‚’è©¦ã™\r\n**ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ãªã‚“ã¦ã™ã‚‹äºˆå®šãªã‘ã©**ã›ã£ã‹ãBetaç‰ˆã®ç™»å ´ã¨ä¸€ç·’ã«APIãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã‚‹ã®ã§è©¦ã—ã«è¿½åŠ ã—ã¦ã¿ã‚‹ã€‚\r\n\r\n[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developer.android.com/preview/features/device-control)\r\n\r\n# ç’°å¢ƒ\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|è¨€èª|Kotlin|\r\n|Android|11 Beta 1|\r\n|ç«¯æœ«|Pixel 3 XL|\r\n\r\n## Android R Betaã®ç’°å¢ƒã‚’æƒãˆã¾ã™ã€‚\r\nSDK Manageré–‹ã„ã¦ã€SDK Platformsã‚¿ãƒ–ã‚’æŠ¼ã—ã¦ã€**Android 10.0+(R)**ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦**Apply**æŠ¼ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n# build.gradle\r\n## ãƒãƒ¼ã‚¸ãƒ§ãƒ³\r\n```gradle\r\nandroid {\r\n    compileSdkVersion 30\r\n    buildToolsVersion \"29.0.3\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.devicecontrolstest\"\r\n        minSdkVersion 30\r\n        targetSdkVersion 30\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`compileSdkVersion 30`ã¨`targetSdkVersion 30`ã«ãªã£ã¦ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚å¤šåˆ†\r\n\r\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã„ã‚Œã‚‹\r\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒRxJavaå…¥ã‚Œã¦ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ã„ã‚‹ã®ã§ç§ã‚‚å…¥ã‚Œã¾ã™ã€‚  \r\nRxJavaãªã‚“ã¦ä½¿ã£ãŸã“ã¨ãªã„ã‚“ã ã‘ã©ã­ã€‚\r\n```gradle\r\ndependencies {\r\n    implementation 'org.reactivestreams:reactive-streams:1.0.3'\r\n    implementation 'io.reactivex.rxjava2:rxjava:2.2.0'\r\n}\r\n```\r\n\r\n# AndroidManifestæ›¸ã\r\nãŠã¾ã˜ãªã„ã§ã™ã€‚\r\n```xml\r\n<service\r\n    android:name=\".DeviceControlsService\"\r\n    android:label=\"@string/app_name\"\r\n    android:permission=\"android.permission.BIND_CONTROLS\">\r\n    <intent-filter>\r\n        <action android:name=\"android.service.controls.ControlsProviderService\" />\r\n    </intent-filter>\r\n</service>\r\n```\r\n\r\n# DeviceControlsService ã£ã¦ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ\r\n`DeviceControlsService.kt`ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nä½œæˆã—ãŸã‚‰ã€`ControlsProviderService()`ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚\r\n```kotlin\r\nclass DeviceControlsService : ControlsProviderService() {\r\n    override fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n\r\n    }\r\n\r\n    override fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n\r\n    }\r\n\r\n    override fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n\r\n    }\r\n}\r\n```\r\n\r\nã§ã‚‚ã“ã®ã¾ã¾ã ã¨è¿”ã‚Šå€¤ãªã«ã‚‚ãªã„ã®ã§IDEãŒèµ¤ã„ãªã¿ãªã¿å‡ºã™ã®ã§ä»Šã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\r\n\r\n## åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’ç”¨æ„ã™ã‚‹\r\nã“ã‚Œã‹ã‚‰è¿½åŠ å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚  \r\nã“ã“ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã¶ã‚ã‘ã§ã™ã­ã€‚  \r\n`createPublisherForAllAvailable()`ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚\r\n```kotlin\r\n// è¿½åŠ ã™ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã®ID\r\nval TOGGLE_BUTTON_ID = \"toggle_button_id\"\r\n/**\r\n * è¿½åŠ å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ã€‚\r\n * */\r\noverride fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸæ™‚ã«è¡¨ç¤ºã™ã‚‹Activity\r\n    val intent = Intent(baseContext, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getActivity(baseContext, 10, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    // ã¾ã¨ã‚ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã®ã§é…åˆ—ã«\r\n    val controlList = mutableListOf<Control>()\r\n    // ON/OFFã‚µãƒ³ãƒ—ãƒ«ã€‚\r\n    val toggleControl = Control.StatelessBuilder(TOGGLE_BUTTON_ID, pendingIntent)\r\n        .setTitle(\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n        .setSubtitle(\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n        .setDeviceType(DeviceTypes.TYPE_LIGHT) // ã‚ã„ã“ã‚“ã¨ã„ã‚ã®è¨­å®šã€‚\r\n        .build()\r\n    // é…åˆ—ã«è¿½åŠ \r\n    controlList.add(toggleControl)\r\n    // Reactive Streamsã®çŸ¥è­˜ãŒå¿…è¦ãªæ¨¡æ§˜ã€‚ç§ã«ã¯ãªã„ã®ã§ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ”ãƒšã™ã‚‹ã€‚\r\n    return FlowAdapters.toFlowPublisher(Flowable.fromIterable(controlList))\r\n}\r\n```\r\n\r\nã‚³ãƒ¡ãƒ³ãƒˆæ–‡ã¯å„è‡ªæ¶ˆã—ã¦ã­ã€‚  \r\n### æ³¨æ„\r\nã“ã“ã§ä½¿ã†`Control`ã¯`Control.StatelessBuilder`ã®æ–¹ã§ã™ã€‚  \r\nã“ã‚Œã¯ã¾ã çŠ¶æ…‹ãŒï¼ˆã‚¹ã‚¤ãƒƒãƒãŒONã¨ã‹OFFã¨ã‹ã£ã¦è©±ï¼‰ãŒåˆ†ã‹ã‚‰ãªã„æ™‚ã«ä½¿ã†ã¨ã‹æ›¸ã„ã¦ã‚ã‚‹ã‘ã©å¤šåˆ†ã“ã®æ™‚ã«ä½¿ã„ã¾ã™ã€‚\r\n\r\n## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹\r\n`åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’ç”¨æ„ã™ã‚‹`ã§é¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nlateinit var updatePublisher: ReplayProcessor<Control>\r\n/**\r\n * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹\r\n * é›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã§ã‚ˆã°ã‚Œã‚‹\r\n * */\r\noverride fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹Activity\r\n    val intent = Intent(baseContext, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getActivity(baseContext, 12, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    // çŸ¥è­˜ä¸è¶³ã§ã‚ã‹ã‚‰ã‚“\r\n    updatePublisher = ReplayProcessor.create()\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼\r\n    if(p0.contains(TOGGLE_BUTTON_ID)) {\r\n        // ON/OFF\r\n        val toggle = ToggleTemplate(\"toggle_template\", ControlButton(false, \"OFFã§ã™ã­ãˆï¼\"))\r\n        // ã“ã“ã§ä½œã‚‹Controlã¯ StatefulBuilder ã‚’ä½¿ã†ã€‚\r\n        val control = Control.StatefulBuilder(TOGGLE_BUTTON_ID, pendingIntent)\r\n            .setTitle(\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n            .setSubtitle(\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n            .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n            .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\n            .setControlTemplate(toggle) // ä»Šå›ã¯ON/OFFãƒœã‚¿ãƒ³\r\n            .build()\r\n        updatePublisher.onNext(control)\r\n    }\r\n    return FlowAdapters.toFlowPublisher(updatePublisher)\r\n}\r\n```\r\n\r\nã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ã¯ä¸€å¿œæ¶ˆãˆã‚‹ã®ã§ã€æ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\r\n\r\n# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼è¿½åŠ \r\né›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã™ã‚‹ã¨ã€**ãƒ‡ãƒã‚¤ã‚¹ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æŠ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  \r\næŠ¼ã™ã¨ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªä¸€è¦§ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ä»Šä½œã£ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚  \r\nã™ã‚‹ã¨ã€ã•ã£ãä½œã£ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒç¾ã‚Œã‚‹ã®ã§ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã€å³ä¸‹ã®ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚  \r\n\r\n![Imgur](https://imgur.com/r2Wyog1.png)\r\n\r\nã™ã‚‹ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚  \r\nã§ã™ãŒã“ã®æ®µéšã§ã¯æŠ¼ã—ã¦ã‚‚ãªã«ã‚‚å¤‰ã‚ã‚‰ãªã„ã®ã§ã“ã‚Œã‹ã‚‰æŠ¼ã—ãŸæ™‚ã«`ON/OFF`ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã¡ãªã¿ã«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§Android 11å‹•ã‹ã™ã®ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒé•·ã‹ã£ãŸã€‚\r\n\r\n# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†\r\næŠ¼ã—ãŸæ™‚ã«ON/OFFã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n```kotlin\r\n/**\r\n * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’æŠ¼ã—ãŸã¨ã\r\n * */\r\noverride fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹Activity\r\n    val intent = Intent(baseContext, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getActivity(baseContext, 11, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    // ã‚·ã‚¹ãƒ†ãƒ ã«å‡¦ç†ä¸­ã¨ãŠã—ãˆã‚‹\r\n    p2.accept(ControlAction.RESPONSE_OK)\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼åˆ†å²\r\n    when (p0) {\r\n        TOGGLE_BUTTON_ID -> {\r\n            // ON/OFFåˆ‡ã‚Šæ›¿ãˆ\r\n            // ToggleTemplate ã¯ BooleanAction\r\n            if (p1 is BooleanAction) {\r\n                // ONã‹ã©ã†ã‹\r\n                val isOn = p1.newState\r\n                val message = if (isOn) \"ONã§ã™\" else \"OFFã§ã™\"\r\n                val toggle = ToggleTemplate(\"toggle_template\", ControlButton(isOn, message))\r\n                // Controlæ›´æ–°\r\n                val control = Control.StatefulBuilder(TOGGLE_BUTTON_ID, pendingIntent)\r\n                    .setTitle(\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n                    .setSubtitle(\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n                    .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n                    .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\n                    .setControlTemplate(toggle) // ä»Šå›ã¯ON/OFFãƒœã‚¿ãƒ³\r\n                    .setStatusText(message)\r\n                    .build()\r\n                updatePublisher.onNext(control)\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§æŠ¼ã—ãŸæ™‚ã«ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  \r\n`DeviceType#TYPE_LIGHT`è¦‹ãŸç›®ã„ã„æ„Ÿã˜ã€‚  \r\nã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ã‚„ã£ã¦ã¿ãŸã„ï¼ˆé‡‘ãªã„ã‘ã©ï¼‰\r\n\r\n![Imgur](https://imgur.com/2TNFYZz.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚https://github.com/takusan23/DeviceControlsTest\r\n\r\n~~ãã‚Œã¨**æœ¬å½“**ã¯ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆå€¤ã‚’èª¿æ•´ã§ãã‚‹`RangeTemplate`ã¦ã‚„ã¤ï¼‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒã‚ã£ãŸã‚“ã§ã™ã‘ã©ã€ç§ã®ç’°å¢ƒã§ã¯ã†ã¾ãå‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚Betaç‰ˆã ã‹ã‚‰ãªã®ã‹ãã‚‚ãã‚‚ç§ãŒé–“é•ã£ã¦ã‚‹ã®ã‹ï¼Ÿ~~\r\n\r\n**RangeTemplate**å‹•ãã¾ã—ãŸã€‚[å‚è€ƒã«ã—ã¾ã—ãŸ](https://gist.github.com/KieronQuinn/c9950f3ee09e11f305ce16e7f48f03b8)\r\n\r\n```kotlin\r\nval sliderControl = Control.StatefulBuilder(SLIDER_BUTTON_ID, pendingIntent)\r\n    .setTitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n    .setSubtitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n    .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n    .setControlId(SLIDER_BUTTON_ID)\r\n    .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\nsliderControl.setControlTemplate(\r\n    ToggleRangeTemplate(\r\n        \"slider_template\",\r\n        ControlButton(true, \"slider_button\"),\r\n        RangeTemplate(\"range\", 0f, 10f, 1f, 1f, null)\r\n    )\r\n)\r\nupdatePublisher.onNext(sliderControl.build())\r\n```\r\n\r\nperformControlAction()ã¯ã“ã†ã§ã™ã€‚\r\n\r\n```kotlin\r\n// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼\r\n// RangeTemplate ã¯ FloatAction\r\nif (p1 is FloatAction) {\r\n    // ç¾åœ¨ã®å€¤\r\n    val currentValue = p1.newValue\r\n    val sliderControl = Control.StatefulBuilder(SLIDER_BUTTON_ID, pendingIntent)\r\n        .setTitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n        .setSubtitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n        .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n        .setControlId(SLIDER_BUTTON_ID)\r\n        .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\n    val controlButton = ControlButton(true, \"slider_button\")\r\n    sliderControl.setControlTemplate(\r\n        ToggleRangeTemplate(\r\n            \"slider_template\",\r\n            controlButton,\r\n            RangeTemplate(\"range\", 0f, 10f, currentValue, 1f, null)\r\n        )\r\n    )\r\n    updatePublisher.onNext(sliderControl.build())\r\n}\r\n```\r\n\r\n\r\nã‚ã¨`DeviceType`ãŒã„ã£ã±ã„ã‚ã‚‹ã®ã§å…¨ç¨®é¡ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²ã‚’è¦‹ã¦ã¿ãŸã„ã€‚ã‚„ã£ã¦ã¿ã‚‹ã‹ã€‚\r\n\r\nã‚„ã‚Šã¾ã—ãŸâ†’ https://github.com/takusan23/DeviceControlAllDeviceTypeSample\r\n\r\n\r\nDynamic Intent Filterã‚‚ã‚„ã‚ŠãŸã„",
  "bodyHtml": "<p>Android 11 Beta ããŸããŠãŠãŠãŠãŠãŠãŠãŠãŠ<br>\nğŸ¥³â†ã“ã‚Œã™ã</p>\n<h1>è¿½è¨˜ï¼š2020/06/13</h1>\n<p>Google PayãŒä½¿ãˆãªã„ã¨è¨€ã„ã¾ã—ãŸã€‚ãŒã€Suicaã§é›»è»Šã«ä¹—ã‚ŒãŸã®ã§å¤šåˆ†<strong>ãŠï½»ï½²ï¾Œï½¹ï½°ï¾€ï½²</strong>ã‚¢ãƒ—ãƒªã§ã¯å¯¾å¿œã—ã¦ã„ãªã„<strong>NFC Pay</strong>ã‚ãŸã‚ŠãŒä½¿ãˆãªã„ã‚“ã ã¨æ€ã„ã¾ã™ã€‚<br>\nFelicaä½¿ã†ç³»ã¯å¤šåˆ†è¡Œã‘ã‚‹ã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ã­ï¼Ÿ</p>\n<p>ã‚ã¨ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼(RangeTemplate)å‹•ã„ãŸã®ã§ãã‚Œã‚‚</p>\n<h1>æœ¬é¡Œ</h1>\n<p>Android 11 Beta 1 æ¥ã¾ã—ãŸã€‚<br>\nã‚ãŸã—çš„ã«æ¥½ã—ã¿ã«ã—ã¦ã‚‹æ©Ÿèƒ½ã¯</p>\n<ul>\n<li>Device Control API (æ­£å¼åç§°ã—ã‚‰ã‚“)\n<ul>\n<li>è¨¼æ˜ã®ON/OFFã¨ã‹æ˜ã‚‹ã•ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãªã©</li>\n<li>Quick Settings ã®ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ç‰ˆ</li>\n<li><strong>ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ãªã‚“ã¦é‡‘ã‹ã‹ã‚‹ã‹ã‚‰ã‚„ã‚‰ãªã„ã¨æ€ã†ï¼ˆã‚ˆã£ã¦ä½¿ã‚ãªã„ï¼‰</strong></li>\n</ul>\n</li>\n<li>Dynamic Intent Filter</li>\n<li>Wi-FiçµŒç”±ã®ADB\n<ul>\n<li>ã‚«ã‚¹ROMã«ã¯å‰ã‹ã‚‰ã‚ã‚‹ã£ã¦ï¼Ÿ</li>\n<li>å…¬å¼ã§å¯¾å¿œãªã‚“ã§ã™ã‚ˆï¼ï¼ï¼</li>\n</ul>\n</li>\n<li>Bubble\n<ul>\n<li><strong>ä»–ã®ã‚¢ãƒ—ãƒªã«é‡ã­ã¦è¡¨ç¤º</strong>ãŒå¹´ã€…å³ã—ããªã£ã¦ã‚‹ã®ã§ï¼ˆæœ€è¿‘ã€è¨­å®šã‚¢ãƒ—ãƒªã®ä¸Šã«è¡¨ç¤ºã§ããªããªã£ãŸï¼‰ä»£æ›¿ã€‚</li>\n<li>ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†ç”Ÿã®ä»£æ›¿ã«ã¯ãªã‚‰ãªãã†ã€‚ã‚ãã¾ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªå‘ã‘ãªã®ã‹ãªã€‚</li>\n</ul>\n</li>\n</ul>\n<h2>Android 11 Betaå…¥ã‚Œã‚ˆã†ã¨ã—ã¦ã„ã‚‹å„ä½</h2>\n<p>Google Pay ä½¿ãˆãªããªã‚‹ã‚‰ã—ã„ã‚ˆã€‚DP4ã®æ®µéšã§ã¯ä½¿ãˆãŸã‚“ã ã‘ã©ã¾ãŸä½¿ãˆãªããªã£ãŸã€‚<br>\n<img src=\"https://imgur.com/r914HON.png\" alt=\"Imgur\"><br>\nSuicaä½¿ãˆã‚‹ã‚“ã‹ãªï¼Ÿ</p>\n<h1>Device Control API ã‚’è©¦ã™</h1>\n<p><strong>ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ãªã‚“ã¦ã™ã‚‹äºˆå®šãªã‘ã©</strong>ã›ã£ã‹ãBetaç‰ˆã®ç™»å ´ã¨ä¸€ç·’ã«APIãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã‚‹ã®ã§è©¦ã—ã«è¿½åŠ ã—ã¦ã¿ã‚‹ã€‚</p>\n<p><a href=\"https://developer.android.com/preview/features/device-control\">ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></p>\n<h1>ç’°å¢ƒ</h1>\n<table>\n<thead>\n<tr>\n<th>ãªã¾ãˆ</th>\n<th>ã‚ãŸã„</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>è¨€èª</td>\n<td>Kotlin</td>\n</tr>\n<tr>\n<td>Android</td>\n<td>11 Beta 1</td>\n</tr>\n<tr>\n<td>ç«¯æœ«</td>\n<td>Pixel 3 XL</td>\n</tr>\n</tbody>\n</table>\n<h2>Android R Betaã®ç’°å¢ƒã‚’æƒãˆã¾ã™ã€‚</h2>\n<p>SDK Manageré–‹ã„ã¦ã€SDK Platformsã‚¿ãƒ–ã‚’æŠ¼ã—ã¦ã€<strong>Android 10.0+(R)<strong>ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦</strong>Apply</strong>æŠ¼ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ã‚‡ã†ã€‚</p>\n<h1>build.gradle</h1>\n<h2>ãƒãƒ¼ã‚¸ãƒ§ãƒ³</h2>\n<pre><code class=\"hljs\">android {\n    compileSdkVersion <span class=\"hljs-number\">30</span>\n    buildToolsVersion <span class=\"hljs-string\">\"29.0.3\"</span>\n\n    defaultConfig {\n        applicationId <span class=\"hljs-string\">\"io.github.takusan23.devicecontrolstest\"</span>\n        minSdkVersion <span class=\"hljs-number\">30</span>\n        targetSdkVersion <span class=\"hljs-number\">30</span>\n        versionCode <span class=\"hljs-number\">1</span>\n        versionName <span class=\"hljs-string\">\"1.0\"</span>\n        testInstrumentationRunner <span class=\"hljs-string\">\"androidx.test.runner.AndroidJUnitRunner\"</span>\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled <span class=\"hljs-keyword\">false</span>\n            proguardFiles getDefaultProguardFile(<span class=\"hljs-string\">'proguard-android-optimize.txt'</span>), <span class=\"hljs-string\">'proguard-rules.pro'</span>\n        }\n    }\n}</code></pre><p><code>compileSdkVersion 30</code>ã¨<code>targetSdkVersion 30</code>ã«ãªã£ã¦ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚å¤šåˆ†</p>\n<h2>ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã„ã‚Œã‚‹</h2>\n<p>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒRxJavaå…¥ã‚Œã¦ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ã„ã‚‹ã®ã§ç§ã‚‚å…¥ã‚Œã¾ã™ã€‚<br>\nRxJavaãªã‚“ã¦ä½¿ã£ãŸã“ã¨ãªã„ã‚“ã ã‘ã©ã­ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">dependencies</span> {\n    implementation <span class=\"hljs-string\">'org.reactivestreams:reactive-streams:1.0.3'</span>\n    implementation <span class=\"hljs-string\">'io.reactivex.rxjava2:rxjava:2.2.0'</span>\n}</code></pre><h1>AndroidManifestæ›¸ã</h1>\n<p>ãŠã¾ã˜ãªã„ã§ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">service</span>\n    <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\".DeviceControlsService\"</span>\n    <span class=\"hljs-attr\">android:label</span>=<span class=\"hljs-string\">\"@string/app_name\"</span>\n    <span class=\"hljs-attr\">android:permission</span>=<span class=\"hljs-string\">\"android.permission.BIND_CONTROLS\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">intent-filter</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">android:name</span>=<span class=\"hljs-string\">\"android.service.controls.ControlsProviderService\"</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">intent-filter</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">service</span>&gt;</span></code></pre><h1>DeviceControlsService ã£ã¦ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ</h1>\n<p><code>DeviceControlsService.kt</code>ã‚’ä½œæˆã—ã¾ã™ã€‚<br>\nä½œæˆã—ãŸã‚‰ã€<code>ControlsProviderService()</code>ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DeviceControlsService</span> : <span class=\"hljs-type\">ControlsProviderService</span></span>() {\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">createPublisherForAllAvailable</span><span class=\"hljs-params\">()</span></span>: Flow.Publisher&lt;Control&gt; {\n\n    }\n\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">performControlAction</span><span class=\"hljs-params\">(p0: <span class=\"hljs-type\">String</span>, p1: <span class=\"hljs-type\">ControlAction</span>, p2: <span class=\"hljs-type\">Consumer</span>&lt;<span class=\"hljs-type\">Int</span>&gt;)</span></span> {\n\n    }\n\n    <span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">createPublisherFor</span><span class=\"hljs-params\">(p0: <span class=\"hljs-type\">MutableList</span>&lt;<span class=\"hljs-type\">String</span>&gt;)</span></span>: Flow.Publisher&lt;Control&gt; {\n\n    }\n}</code></pre><p>ã§ã‚‚ã“ã®ã¾ã¾ã ã¨è¿”ã‚Šå€¤ãªã«ã‚‚ãªã„ã®ã§IDEãŒèµ¤ã„ãªã¿ãªã¿å‡ºã™ã®ã§ä»Šã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p>\n<h2>åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’ç”¨æ„ã™ã‚‹</h2>\n<p>ã“ã‚Œã‹ã‚‰è¿½åŠ å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚<br>\nã“ã“ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã¶ã‚ã‘ã§ã™ã­ã€‚<br>\n<code>createPublisherForAllAvailable()</code>ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-comment\">// è¿½åŠ ã™ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã®ID</span>\n<span class=\"hljs-keyword\">val</span> TOGGLE_BUTTON_ID = <span class=\"hljs-string\">\"toggle_button_id\"</span>\n<span class=\"hljs-comment\">/**\n * è¿½åŠ å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ã€‚\n * */</span>\n<span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">createPublisherForAllAvailable</span><span class=\"hljs-params\">()</span></span>: Flow.Publisher&lt;Control&gt; {\n    <span class=\"hljs-comment\">// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸæ™‚ã«è¡¨ç¤ºã™ã‚‹Activity</span>\n    <span class=\"hljs-keyword\">val</span> intent = Intent(baseContext, MainActivity::<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>.<span class=\"hljs-title\">java</span>)</span>\n    <span class=\"hljs-keyword\">val</span> pendingIntent =\n        PendingIntent.getActivity(baseContext, <span class=\"hljs-number\">10</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT)\n    <span class=\"hljs-comment\">// ã¾ã¨ã‚ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã®ã§é…åˆ—ã«</span>\n    <span class=\"hljs-keyword\">val</span> controlList = mutableListOf&lt;Control&gt;()\n    <span class=\"hljs-comment\">// ON/OFFã‚µãƒ³ãƒ—ãƒ«ã€‚</span>\n    <span class=\"hljs-keyword\">val</span> toggleControl = Control.StatelessBuilder(TOGGLE_BUTTON_ID, pendingIntent)\n        .setTitle(<span class=\"hljs-string\">\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\"</span>) <span class=\"hljs-comment\">// ãŸã„ã¨ã‚‹</span>\n        .setSubtitle(<span class=\"hljs-string\">\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\"</span>) <span class=\"hljs-comment\">// ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</span>\n        .setDeviceType(DeviceTypes.TYPE_LIGHT) <span class=\"hljs-comment\">// ã‚ã„ã“ã‚“ã¨ã„ã‚ã®è¨­å®šã€‚</span>\n        .build()\n    <span class=\"hljs-comment\">// é…åˆ—ã«è¿½åŠ </span>\n    controlList.add(toggleControl)\n    <span class=\"hljs-comment\">// Reactive Streamsã®çŸ¥è­˜ãŒå¿…è¦ãªæ¨¡æ§˜ã€‚ç§ã«ã¯ãªã„ã®ã§ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ”ãƒšã™ã‚‹ã€‚</span>\n    <span class=\"hljs-keyword\">return</span> FlowAdapters.toFlowPublisher(Flowable.fromIterable(controlList))\n}</code></pre><p>ã‚³ãƒ¡ãƒ³ãƒˆæ–‡ã¯å„è‡ªæ¶ˆã—ã¦ã­ã€‚</p>\n<h3>æ³¨æ„</h3>\n<p>ã“ã“ã§ä½¿ã†<code>Control</code>ã¯<code>Control.StatelessBuilder</code>ã®æ–¹ã§ã™ã€‚<br>\nã“ã‚Œã¯ã¾ã çŠ¶æ…‹ãŒï¼ˆã‚¹ã‚¤ãƒƒãƒãŒONã¨ã‹OFFã¨ã‹ã£ã¦è©±ï¼‰ãŒåˆ†ã‹ã‚‰ãªã„æ™‚ã«ä½¿ã†ã¨ã‹æ›¸ã„ã¦ã‚ã‚‹ã‘ã©å¤šåˆ†ã“ã®æ™‚ã«ä½¿ã„ã¾ã™ã€‚</p>\n<h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹</h2>\n<p><code>åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’ç”¨æ„ã™ã‚‹</code>ã§é¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">lateinit</span> <span class=\"hljs-keyword\">var</span> updatePublisher: ReplayProcessor&lt;Control&gt;\n<span class=\"hljs-comment\">/**\n * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹\n * é›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã§ã‚ˆã°ã‚Œã‚‹\n * */</span>\n<span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">createPublisherFor</span><span class=\"hljs-params\">(p0: <span class=\"hljs-type\">MutableList</span>&lt;<span class=\"hljs-type\">String</span>&gt;)</span></span>: Flow.Publisher&lt;Control&gt; {\n    <span class=\"hljs-comment\">// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹Activity</span>\n    <span class=\"hljs-keyword\">val</span> intent = Intent(baseContext, MainActivity::<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>.<span class=\"hljs-title\">java</span>)</span>\n    <span class=\"hljs-keyword\">val</span> pendingIntent =\n        PendingIntent.getActivity(baseContext, <span class=\"hljs-number\">12</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT)\n    <span class=\"hljs-comment\">// çŸ¥è­˜ä¸è¶³ã§ã‚ã‹ã‚‰ã‚“</span>\n    updatePublisher = ReplayProcessor.create()\n    <span class=\"hljs-comment\">// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼</span>\n    <span class=\"hljs-keyword\">if</span>(p0.contains(TOGGLE_BUTTON_ID)) {\n        <span class=\"hljs-comment\">// ON/OFF</span>\n        <span class=\"hljs-keyword\">val</span> toggle = ToggleTemplate(<span class=\"hljs-string\">\"toggle_template\"</span>, ControlButton(<span class=\"hljs-literal\">false</span>, <span class=\"hljs-string\">\"OFFã§ã™ã­ãˆï¼\"</span>))\n        <span class=\"hljs-comment\">// ã“ã“ã§ä½œã‚‹Controlã¯ StatefulBuilder ã‚’ä½¿ã†ã€‚</span>\n        <span class=\"hljs-keyword\">val</span> control = Control.StatefulBuilder(TOGGLE_BUTTON_ID, pendingIntent)\n            .setTitle(<span class=\"hljs-string\">\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\"</span>) <span class=\"hljs-comment\">// ãŸã„ã¨ã‚‹</span>\n            .setSubtitle(<span class=\"hljs-string\">\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\"</span>) <span class=\"hljs-comment\">// ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</span>\n            .setDeviceType(DeviceTypes.TYPE_LIGHT) <span class=\"hljs-comment\">// å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ</span>\n            .setStatus(Control.STATUS_OK) <span class=\"hljs-comment\">// ç¾åœ¨ã®çŠ¶æ…‹</span>\n            .setControlTemplate(toggle) <span class=\"hljs-comment\">// ä»Šå›ã¯ON/OFFãƒœã‚¿ãƒ³</span>\n            .build()\n        updatePublisher.onNext(control)\n    }\n    <span class=\"hljs-keyword\">return</span> FlowAdapters.toFlowPublisher(updatePublisher)\n}</code></pre><p>ã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ã¯ä¸€å¿œæ¶ˆãˆã‚‹ã®ã§ã€æ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>\n<h1>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼è¿½åŠ </h1>\n<p>é›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã™ã‚‹ã¨ã€<strong>ãƒ‡ãƒã‚¤ã‚¹ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</strong>ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æŠ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br>\næŠ¼ã™ã¨ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªä¸€è¦§ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ä»Šä½œã£ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚<br>\nã™ã‚‹ã¨ã€ã•ã£ãä½œã£ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒç¾ã‚Œã‚‹ã®ã§ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã€å³ä¸‹ã®ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚</p>\n<p><img src=\"https://imgur.com/r2Wyog1.png\" alt=\"Imgur\"></p>\n<p>ã™ã‚‹ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚<br>\nã§ã™ãŒã“ã®æ®µéšã§ã¯æŠ¼ã—ã¦ã‚‚ãªã«ã‚‚å¤‰ã‚ã‚‰ãªã„ã®ã§ã“ã‚Œã‹ã‚‰æŠ¼ã—ãŸæ™‚ã«<code>ON/OFF</code>ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚</p>\n<p>ã¡ãªã¿ã«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§Android 11å‹•ã‹ã™ã®ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒé•·ã‹ã£ãŸã€‚</p>\n<h1>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†</h1>\n<p>æŠ¼ã—ãŸæ™‚ã«ON/OFFã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-comment\">/**\n * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’æŠ¼ã—ãŸã¨ã\n * */</span>\n<span class=\"hljs-keyword\">override</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">fun</span> <span class=\"hljs-title\">performControlAction</span><span class=\"hljs-params\">(p0: <span class=\"hljs-type\">String</span>, p1: <span class=\"hljs-type\">ControlAction</span>, p2: <span class=\"hljs-type\">Consumer</span>&lt;<span class=\"hljs-type\">Int</span>&gt;)</span></span> {\n    <span class=\"hljs-comment\">// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹Activity</span>\n    <span class=\"hljs-keyword\">val</span> intent = Intent(baseContext, MainActivity::<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>.<span class=\"hljs-title\">java</span>)</span>\n    <span class=\"hljs-keyword\">val</span> pendingIntent =\n        PendingIntent.getActivity(baseContext, <span class=\"hljs-number\">11</span>, intent, PendingIntent.FLAG_UPDATE_CURRENT)\n    <span class=\"hljs-comment\">// ã‚·ã‚¹ãƒ†ãƒ ã«å‡¦ç†ä¸­ã¨ãŠã—ãˆã‚‹</span>\n    p2.accept(ControlAction.RESPONSE_OK)\n    <span class=\"hljs-comment\">// ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼åˆ†å²</span>\n    <span class=\"hljs-keyword\">when</span> (p0) {\n        TOGGLE_BUTTON_ID -&gt; {\n            <span class=\"hljs-comment\">// ON/OFFåˆ‡ã‚Šæ›¿ãˆ</span>\n            <span class=\"hljs-comment\">// ToggleTemplate ã¯ BooleanAction</span>\n            <span class=\"hljs-keyword\">if</span> (p1 <span class=\"hljs-keyword\">is</span> BooleanAction) {\n                <span class=\"hljs-comment\">// ONã‹ã©ã†ã‹</span>\n                <span class=\"hljs-keyword\">val</span> isOn = p1.newState\n                <span class=\"hljs-keyword\">val</span> message = <span class=\"hljs-keyword\">if</span> (isOn) <span class=\"hljs-string\">\"ONã§ã™\"</span> <span class=\"hljs-keyword\">else</span> <span class=\"hljs-string\">\"OFFã§ã™\"</span>\n                <span class=\"hljs-keyword\">val</span> toggle = ToggleTemplate(<span class=\"hljs-string\">\"toggle_template\"</span>, ControlButton(isOn, message))\n                <span class=\"hljs-comment\">// Controlæ›´æ–°</span>\n                <span class=\"hljs-keyword\">val</span> control = Control.StatefulBuilder(TOGGLE_BUTTON_ID, pendingIntent)\n                    .setTitle(<span class=\"hljs-string\">\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\"</span>) <span class=\"hljs-comment\">// ãŸã„ã¨ã‚‹</span>\n                    .setSubtitle(<span class=\"hljs-string\">\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\"</span>) <span class=\"hljs-comment\">// ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</span>\n                    .setDeviceType(DeviceTypes.TYPE_LIGHT) <span class=\"hljs-comment\">// å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ</span>\n                    .setStatus(Control.STATUS_OK) <span class=\"hljs-comment\">// ç¾åœ¨ã®çŠ¶æ…‹</span>\n                    .setControlTemplate(toggle) <span class=\"hljs-comment\">// ä»Šå›ã¯ON/OFFãƒœã‚¿ãƒ³</span>\n                    .setStatusText(message)\n                    .build()\n                updatePublisher.onNext(control)\n            }\n        }\n    }\n}</code></pre><p>ã“ã‚Œã§æŠ¼ã—ãŸæ™‚ã«ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚<br>\n<code>DeviceType#TYPE_LIGHT</code>è¦‹ãŸç›®ã„ã„æ„Ÿã˜ã€‚<br>\nã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ã‚„ã£ã¦ã¿ãŸã„ï¼ˆé‡‘ãªã„ã‘ã©ï¼‰</p>\n<p><img src=\"https://imgur.com/2TNFYZz.png\" alt=\"Imgur\"></p>\n<h1>ãŠã‚ã‚Šã«</h1>\n<p>ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚<a href=\"https://github.com/takusan23/DeviceControlsTest\">https://github.com/takusan23/DeviceControlsTest</a></p>\n<p><s>ãã‚Œã¨<strong>æœ¬å½“</strong>ã¯ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆå€¤ã‚’èª¿æ•´ã§ãã‚‹<code>RangeTemplate</code>ã¦ã‚„ã¤ï¼‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒã‚ã£ãŸã‚“ã§ã™ã‘ã©ã€ç§ã®ç’°å¢ƒã§ã¯ã†ã¾ãå‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚Betaç‰ˆã ã‹ã‚‰ãªã®ã‹ãã‚‚ãã‚‚ç§ãŒé–“é•ã£ã¦ã‚‹ã®ã‹ï¼Ÿ</s></p>\n<p><strong>RangeTemplate</strong>å‹•ãã¾ã—ãŸã€‚<a href=\"https://gist.github.com/KieronQuinn/c9950f3ee09e11f305ce16e7f48f03b8\">å‚è€ƒã«ã—ã¾ã—ãŸ</a></p>\n<pre><code class=\"hljs\"><span class=\"hljs-keyword\">val</span> sliderControl = Control.StatefulBuilder(SLIDER_BUTTON_ID, pendingIntent)\n    .setTitle(<span class=\"hljs-string\">\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒ«\"</span>) <span class=\"hljs-comment\">// ãŸã„ã¨ã‚‹</span>\n    .setSubtitle(<span class=\"hljs-string\">\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã™ã€‚\"</span>) <span class=\"hljs-comment\">// ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</span>\n    .setDeviceType(DeviceTypes.TYPE_LIGHT) <span class=\"hljs-comment\">// å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ</span>\n    .setControlId(SLIDER_BUTTON_ID)\n    .setStatus(Control.STATUS_OK) <span class=\"hljs-comment\">// ç¾åœ¨ã®çŠ¶æ…‹</span>\nsliderControl.setControlTemplate(\n    ToggleRangeTemplate(\n        <span class=\"hljs-string\">\"slider_template\"</span>,\n        ControlButton(<span class=\"hljs-literal\">true</span>, <span class=\"hljs-string\">\"slider_button\"</span>),\n        RangeTemplate(<span class=\"hljs-string\">\"range\"</span>, <span class=\"hljs-number\">0f</span>, <span class=\"hljs-number\">10f</span>, <span class=\"hljs-number\">1f</span>, <span class=\"hljs-number\">1f</span>, <span class=\"hljs-literal\">null</span>)\n    )\n)\nupdatePublisher.onNext(sliderControl.build())</code></pre><p>performControlAction()ã¯ã“ã†ã§ã™ã€‚</p>\n<pre><code class=\"hljs\"><span class=\"hljs-comment\">// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼</span>\n<span class=\"hljs-comment\">// RangeTemplate ã¯ FloatAction</span>\n<span class=\"hljs-keyword\">if</span> (p1 <span class=\"hljs-keyword\">is</span> FloatAction) {\n    <span class=\"hljs-comment\">// ç¾åœ¨ã®å€¤</span>\n    <span class=\"hljs-keyword\">val</span> currentValue = p1.newValue\n    <span class=\"hljs-keyword\">val</span> sliderControl = Control.StatefulBuilder(SLIDER_BUTTON_ID, pendingIntent)\n        .setTitle(<span class=\"hljs-string\">\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒ«\"</span>) <span class=\"hljs-comment\">// ãŸã„ã¨ã‚‹</span>\n        .setSubtitle(<span class=\"hljs-string\">\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã™ã€‚\"</span>) <span class=\"hljs-comment\">// ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«</span>\n        .setDeviceType(DeviceTypes.TYPE_LIGHT) <span class=\"hljs-comment\">// å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ</span>\n        .setControlId(SLIDER_BUTTON_ID)\n        .setStatus(Control.STATUS_OK) <span class=\"hljs-comment\">// ç¾åœ¨ã®çŠ¶æ…‹</span>\n    <span class=\"hljs-keyword\">val</span> controlButton = ControlButton(<span class=\"hljs-literal\">true</span>, <span class=\"hljs-string\">\"slider_button\"</span>)\n    sliderControl.setControlTemplate(\n        ToggleRangeTemplate(\n            <span class=\"hljs-string\">\"slider_template\"</span>,\n            controlButton,\n            RangeTemplate(<span class=\"hljs-string\">\"range\"</span>, <span class=\"hljs-number\">0f</span>, <span class=\"hljs-number\">10f</span>, currentValue, <span class=\"hljs-number\">1f</span>, <span class=\"hljs-literal\">null</span>)\n        )\n    )\n    updatePublisher.onNext(sliderControl.build())\n}</code></pre><p>ã‚ã¨<code>DeviceType</code>ãŒã„ã£ã±ã„ã‚ã‚‹ã®ã§å…¨ç¨®é¡ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²ã‚’è¦‹ã¦ã¿ãŸã„ã€‚ã‚„ã£ã¦ã¿ã‚‹ã‹ã€‚</p>\n<p>ã‚„ã‚Šã¾ã—ãŸâ†’ <a href=\"https://github.com/takusan23/DeviceControlAllDeviceTypeSample\">https://github.com/takusan23/DeviceControlAllDeviceTypeSample</a></p>\n<p>Dynamic Intent Filterã‚‚ã‚„ã‚ŠãŸã„</p>\n",
  "dir": "contents/posts/json",
  "base": "android11_devicecontrol.json",
  "ext": ".json",
  "sourceBase": "android11_devicecontrol.md",
  "sourceExt": ".md"
}